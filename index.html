<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>购物车</title>
    <script src="angular.min.js"></script>
    <link rel="stylesheet" href="bootstrap/dist/css/bootstrap.min.css">
</head>
<body ng-app="myapp">

<div ng-controller="ctrl">
   <!--  {{date | date:"yyyy-MM-dd HH:mm:ss"}} -->
    <div class="text-center" ng-show="data.length==0">购物车为空</div>
    <div class="input-group">
        <div class="input-group-addon glyphicon glyphicon-search"></div>
        <input class="form-control" type="text" placeholder="请输入你要搜索的内容"  ng-model="search">
    </div>
    <table class="table table-bordered text-center table-striped" ng-show="data.length!=0">
        <tr>
            <th class="text-center">商品名称</th>
            <th class="text-center">商品数量</th>
            <th class="text-center">商品单价</th>
            <th class="text-center">商品折扣</th>
            <th class="text-center">商品总价</th>
            <th class="text-center">操作</th>
        </tr>
        <tr ng-repeat="item in data | filter :search">
            <td>{{item.name}}</td>
            <td>
                <button type="button" class="btn btn-primary btn-lg active" ng-click="add(item.id)">+</button>
                <input type="text" ng-model="item.num" style="width:52px;height: 50px;">
                <button type="button" class="btn btn-default btn-lg active" ng-click="jian(item.id)">-</button>
            </td>
            <td>{{item.danjia}}</td>
            <td>{{item.zk*item.danjia}}</td>
            <td>{{item.danjia*item.num}}</td>
            <td><button type="button" class="btn btn-warning" ng-click="del(item.id)">删除</button></td>
        </tr>
        <tr>
            <td>商品总数</td>
            <td>{{nums()}}</td>
            <td>总价</td>
            <td colspan="2">{{prices()}}</td>
            <td><button type="button" class="btn btn-warning" ng-click="clear()">清空购物车</button></td>
        </tr>
</table>
</div>
<script>
    angular.module("myapp",[])
            .controller("ctrl",function($scope){
                $scope.data=[
                    {
                        id:1,
                        name:"衣服",
                        danjia:200,
                        zk:.8,
                        num:10
                    },
                    {
                        id:2,
                        name:"鞋子",
                        danjia:200,
                        zk:.8,
                        num:20
                    },
                    {
                        id:3,
                        name:"帽子",
                        danjia:200,
                        zk:.8,
                        num:30
                    },
                    {
                        id:4,
                        name:"袜子",
                        danjia:200,
                        zk:.8,
                        num:40
                    }];
                $scope.nums=function(){
                    var nums=0;
                    angular.forEach($scope.data,function(val,index){
                        if(parseInt(val.num)){
                            val.num=parseInt(val.num);
                            num=parseInt(val.num);
                        }else{
                            val.num=0;
                            num=0;
                        }
                        nums+=num;
                    })
                    return nums;
                };
                $scope.prices=function(){
                    var num=0;
                    angular.forEach($scope.data,function(val,index){
                        num+=val.num*val.danjia*val.zk;
                    })
                    return num;
                };
                $scope.del=function(id){
                    angular.forEach($scope.data,function(val,index){
                        if(val.id== id ){
                            $scope.data.splice(index,1);
                        }
                    })
                };
                $scope.clear=function(){
                    $scope.data=[];
                };
                $scope.add=function(id){
                    for (var i=0;i<$scope.data.length;i++){
                        if($scope.data[i].id==id){
                            $scope.data[i].num++;
                        }
                    }
                };
                $scope.jian=function(id){
                    for (var i=0;i<$scope.data.length;i++){
                        if($scope.data[i].id==id){
                            $scope.data[i].num--;
                            if($scope.data[i].num<=0){
                                $scope.data[i].num=0;
                            }
                        }
                    }
                }
                $scope.date=new Date();
                //alert($scope.date)

            })
</script>
</body>
</html>